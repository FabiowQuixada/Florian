<html>
  <head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawCharts);
      
      function drawCharts() {
        
        // For each year...
        <% @list_of_lists.each do |month_list| %>

        year = <%= month_list[0] %>;
        months_array0 = new Array();
        months_array1 = new Array();
        months_array2 = new Array();

        // For each month...
        <% month_list[1].each_with_index do |month, i| %>

        <% for kk in 0..(NUMBER_OF_BILLS-1) do %>

        <% m = Array.new %>

          // TODO Rewrite the whoel thing
         <% m[kk] = ("['" + (I18n.t :abbr_month_names, :scope => :date)[i+1].to_s + "', " + month[kk].to_s.gsub('.', '').gsub(',', '.') + "]") %>

         months_array<%= kk %>.push(<%= m[kk].html_safe %>);

        <% end %>

       

        <% end %>
        
        draw_chart_by_year(year, months_array0, 0);
        draw_chart_by_year(year, months_array1, 1);
        draw_chart_by_year(year, months_array2, 2);

        <% end %>
      }

      function draw_chart_by_year(year, months_array, type) {

        var data = new google.visualization.DataTable();
        data.addColumn('string', '<%= t('datetime.prompts.month') %>');
        data.addColumn('number', '<%= t('number.value') %>');
        data.addRows(months_array);

        var options = {
          hAxis: {titleTextStyle: {color: '#333'}},
          vAxis: {minValue: 0, viewWindowMode: "explicit", viewWindow:{ min: 0 }, format: '0'},
          'width': 500,
          legend: {position: 'none'}
        };

        { format:'#,###%'}

        var formatter = new google.visualization.NumberFormat({decimalSymbol: ',',groupingSymbol: '.', negativeColor: 'red', negativeParens: true, prefix: 'R$ '});
        formatter.format(data, 1);

        var chart = new google.visualization.AreaChart(document.getElementById('chart_div_' + year + '_' + type));
        chart.draw(data, options);
      }

    </script>
  </head>
  <body>
    <ul class="nav nav-tabs">
    <% @list_of_lists.each_with_index do |bill, i| %>
        <li id="bill_tab_<%= i %>_title" class="clickable"><a><%= bill[0] %></a></li>
    <% end %>
    </ul>

    <% @list_of_lists.each_with_index do |bill, i| %>

      <div id="bill_tab_<%= i %>" class="container-fluid tab_body">

        <!-- Year's bills (titles) -->
        <ul class="nav nav-pills">
          <li id="<%= bill[0].to_s %>_tab_0_title" class="active clickable"><a><%= t('activerecord.attributes.bill.water') %></a></li>
          <li id="<%= bill[0].to_s %>_tab_1_title" class="clickable"><a><%= t('activerecord.attributes.bill.energy') %></a></li>
          <li id="<%= bill[0].to_s %>_tab_2_title" class="clickable"><a><%= t('activerecord.attributes.bill.telephone') %></a></li>
        </ul>

        <!-- Year's bills (bodies) -->
        <% for kk in 0..(NUMBER_OF_BILLS-1) do %>
        <div id="<%= bill[0].to_s %>_tab_<%= kk %>">
            <div id="chart_div_<%= bill[0].to_s %>_<%= kk %>" style="display: block; margin: 0 auto"></div>
        </div>
        <% end %>

      </div>

      <%= render partial: "shared/tab_commons", locals: {number_of_tabs: NUMBER_OF_BILLS, tab_type: bill[0].to_s} %>
      
      <% end %>
  </body>

  <%= render partial: "shared/tab_commons", locals: {number_of_tabs: @list_of_lists.length, tab_type: 'bill', title: Time.now.year} %>
</html>