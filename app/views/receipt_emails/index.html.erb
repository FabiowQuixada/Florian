
<%= link_to genderize_full_tag(@model, 'helpers.action.new'), new_receipt_email_path, class: 'btn btn-primary' %>
<%= link_to t('helpers.receipt_email.recent'), 'javascript:void(0)', id: 'recent_emails_btn', class: 'btn btn-primary' %>

<br/>

<table id="index_table" class="table table-striped table-hover table-bordered table-condensed tablesorter tablesorter-blue">
	<thead>
		<tr>
			<% I18n.with_options(scope: 'activerecord.attributes.receipt_email') do |i18n| %>
			<th class="admin-only id-column"></th>
			<th class="sorter-false"><%= i18n.t :day %></th>
			<th class="sorter-false hidden-xs"><%= i18n.t :company %></th>
			<th class="sorter-false hidden-xs"><%= i18n.t :competence %></th>
			<th class="sorter-false hidden-xs" style="width: 150px;"><%= i18n.t :value %></th>
			<th class="sorter-false icon-column"></th>
			<th class="sorter-false hidden-xs icon-column"></th>
			<th class="sorter-false hidden-xs icon-column"></th>
			<th class="hidden-xs sorter-false icon-column"></th>
			<th class="admin-only sorter-false icon-column"></th>
			<% end %>
		</tr>
	</thead>

	<tbody>
		<% if @list.empty? %>
		<tr>
			<td colspan="10" bgcolor="#E0E0F4" align="center"><%= genderize_tag(@model, 'helpers.none_registered') %></td>
		</tr>

		<% else %>
		<% @list.each do |iterator| %>
		<tr id="model_<%= iterator.id %>" class="model_row">
			<td class="model_id admin-only"><%= iterator.id %></td>
			<td><%= iterator.day_of_month %></td>
			<td class="hidden-xs receipt_company"><%= iterator.company.name %></td>
			<td class="hidden-xs"><%= iterator.competence.capitalize %></td>
			<td class="hidden-xs"><%= number_to_currency(iterator.value) %></td>
			<td class="icon-column"><%= link_to image_tag('edit.png', title: t('helpers.action.edit')), edit_receipt_email_path(iterator) %></td>
			<td class="hidden-xs icon-column"><%= link_to image_tag('send_email.png', title: t('description.email.resend')), 'javascript:void(0)', class: 'resend_btn' %></td>
			<td class="hidden-xs icon-column"><%= link_to image_tag('test_email.png', title: t('description.email.send_test') + " '" + current_user.email + "'"), 'javascript:void(0)', remote: true, class: 'send_test_btn' %></td>
			<td class="hidden-xs status icon-column">
				<% if iterator.active %>
				<%= link_to image_tag('activate.png', title: genderize_tag(iterator, 'is_active'), class: 'deactivate_btn status_btn'), deactivate_receipt_email_path(iterator), method: :post, remote: true, id: 'change_status_' + iterator.id.to_s, 'data-type' => :json, class: 'deactivate_btn' %>
				<% else %>
				<%= link_to image_tag('deactivate.png', title: genderize_tag(iterator, 'is_inactive'), class: 'activate_btn status_btn'), activate_receipt_email_path(iterator), method: :post, remote: true, id: 'change_status_' + iterator.id.to_s, 'data-type' => :json, class: 'activate_btn' %>
				<% end %>
			</td>
			<td class="admin-only icon-column">
				<%= image_tag('destroy.png', title: t('helpers.action.destroy'), class: 'clickable destroy_btn') %>
			</td>
		</tr>
		<% end %>
		<% end %>
	</tbody>
</table>

<%= render partial: 'shared/index_commons', locals: {model: @model} %>

<div class="asterisk-description"><%= t('helpers.receipt_email.index_footer', time: ReceiptEmail::DAILY_SEND_HOUR.to_s) %></div>

<script>

	$(document).ready(function() {

		$('.resend_btn').click(function(ev) {

			clean_resend_modal();

			id = $(this).parent().parent().find('.model_id').text();
			$('#resend_email_id').val(id);
			$('#resend_email_form').get(0).setAttribute('action', '/receipt_emails/' + id + '/resend');
			$('.modal_company_name').text($(this).parent().parent().find('.receipt_company').text());
			$('#resend_email_modal').modal('show');
		});


		$('.send_test_btn').click(function(ev) {

			clean_send_test_modal();

			id = $(this).parent().parent().find('.model_id').text();
			$('#send_test_email_id').val(id);
			$('#send_test_email_form').get(0).setAttribute('action', '/receipt_emails/' + id + '/send_test');
			$('.modal_company_name').text($(this).parent().parent().find('.receipt_company').text());
			$('#send_test_email_modal').modal('show');
		});


		$('#recent_emails_btn').click(function(ev) {
			$('#recent_emails_modal').modal('show');
		});
	});
</script>
