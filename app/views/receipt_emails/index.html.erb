
<%= new_btn %>
<%= recent_emails_btn %>

<br/>

<table id="index_table" class="table table-striped table-hover table-bordered table-condensed tablesorter tablesorter-blue">
	<thead>
		<tr>
			<% I18n.with_options(scope: 'activerecord.attributes.receipt_email') do |i18n| %>
				<th class="admin-only id-column"></th>
				<th class="sorter-false hidden-xs"><%= i18n.t :maintainer %></th>
				<th class="sorter-false hidden-xs value-column"><%= i18n.t :value %></th>
				<th class="sorter-false icon-column"></th>
				<th class="sorter-false hidden-xs icon-column"></th>
				<th class="sorter-false hidden-xs icon-column"></th>
				<th class="hidden-xs sorter-false icon-column"></th>
				<th class="admin-only sorter-false icon-column"></th>
			<% end %>
		</tr>
	</thead>

	<tbody>
		<%= no_records_row @model, @list %>
		<% @list.each do |iterator| %>
			<tr id="model_<%= iterator.id %>" class="model_row">
				<td class="model_id admin-only"><%= iterator.id %></td>
				<td class="hidden-xs receipt_maintainer"><%= iterator.maintainer.name %></td>
				<td class="hidden-xs"><%= number_to_currency(iterator.value) %></td>
				<td class="icon-column"><%= edit_btn iterator %></td>
				<td class="hidden-xs icon-column"><%= resend_btn %></td>
				<td class="hidden-xs icon-column"><%= send_test_btn %></td>
				<td class="hidden-xs status icon-column"><%= status_btn iterator %></td>
				<td class="admin-only icon-column"><%= destroy_btn %></td>
			</tr>
		<% end %>
	</tbody>
</table>

<%= render 'shared/index_commons' %>

<div class="asterisk-description"><%= t('helpers.receipt_email.index_footer', time: ReceiptEmail::DAILY_SEND_HOUR.to_s, competence: (Date.today + 1.month).strftime("%B/%Y").capitalize) %></div>

<script>

	$(document).ready(function() {

		$('.resend_btn').click(function(ev) {

			clean_resend_modal();

			id = $(this).closest('.model_row').find('.model_id').text();
			$('#resend_email_id').val(id);
			$('#resend_email_form').get(0).setAttribute('action', resend_path(id));
			$('.modal_maintainer_name').text($(this).closest('.model_row').find('.receipt_maintainer').text());
			$('#resend_email_modal').modal('show');
		});


		$('.send_test_btn').click(function(ev) {

			clean_send_test_modal();

			id = $(this).closest('.model_row').find('.model_id').text();
			$('#send_test_email_id').val(id);
			$('#send_test_email_form').get(0).setAttribute('action', send_test_path(id));
			$('.modal_maintainer_name').text($(this).closest('.model_row').find('.receipt_maintainer').text());
			$('#send_test_email_modal').modal('show');
		});


		$('#recent_emails_btn').click(function(ev) {
			$('#recent_emails_modal').modal('show');
		});

		function resend_path(id) {
			return '<%= resend_receipt_email_path -1 %>'.replace("-1", id);
		}

		function send_test_path(id) {
			return '<%= send_test_receipt_email_path -1 %>'.replace("-1", id);
		}
	});
</script>
