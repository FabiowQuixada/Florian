<div class="row">
			<div class="form-group col-md-12">

				<div class="row">
					<div class="form-group col-md-6">

						<%= f.label :first_parcel %>
						<div class="input-group date" data-behaviour='datepicker' >
							<%= f.text_field :first_parcel, {class: 'form-control'} %><span class="input-group-addon"><i class="glyphicon glyphicon-th"></i></span>
						</div>
					</div><div class="form-group col-md-6">
					<%= label_tag 'company_last_parcel', t('activerecord.attributes.company.last_parcel') %>
					<%= text_field_tag :last_parcel, '', {id: 'company_last_parcel', class: 'form-control', readonly: true} %>
				</div>
			</div><div class="row">
				<div class="form-group col-md-4">
					<%= f.label :payment_frequency %>
					<%= f.select :payment_frequency, Company.payment_frequencies.keys, {include_blank: t('helpers.select.prompt')}, { class: 'form-control' } %>
				</div>
				<div class="form-group col-md-4">
					<%= f.label :payment_period, class: 'asterisk' %>
					<%= f.text_field :payment_period, class: 'form-control numbers_only' %>
				</div>
				<div class="form-group col-md-4">
					<%= f.label :contract %>
					<%= f.select :contract, Company.contracts.keys, {include_blank: t('helpers.select.prompt')}, { class: 'form-control' } %>
				</div>

				<div class="form-group col-md-12 asterisk-description">* Digite 0 para "Indeterminado".</div>
			</div><div class="row">
				<div class="container-fluid">
					<div class="panel panel-default">
						<div class="panel-heading"><%= t('helpers.company.new_donation') %></div>
						<div class="panel-body">

							<%= render partial: 'shared/error_alert', locals: {id: 'donation'} %>

							<div class="row">
								<div class="form-group col-md-4">
									<div class="input-group date" data-behaviour='datepicker' >
										<%= text_field_tag :donation_date, '', id: 'new_donation_date', class: 'form-control datepicker temp_field' %><span class="input-group-addon"><i class="glyphicon glyphicon-th"></i></span>
									</div>
								</div>
								<div class="form-group col-md-3">
									<div class="input-group">
										<span class="input-group-addon">R$</span>
										<%= text_field_tag :value, '', id: 'new_donation_value', class: 'form-control money temp_field' %>
									</div>
								</div>
								<div class="form-group col-md-5">
									<%= text_field_tag :remark, '', id: 'new_donation_remark', placeholder: t('activerecord.attributes.donation.remark'), class: 'form-control temp_field' %>
								</div>
							</div>

							<div class="row">
								<div class="col-md-12 right">
									<a id="add_donation_btn" class="btn btn-primary btn-xs add_btn"><%= t('helpers.action.add') %></a>
								</div></div>
							</div>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-12">

						<table id="donations_table" class="table table-striped table-condensed table-bordered unbreakable-table">
							<thead class="hidden-xs">
								<tr>
									<% I18n.with_options(scope: 'activerecord.attributes.donation') do |i18n| %>
									<th class="admin-only" style="display:none;"><%= i18n.t :id %></th>
									<th><%= i18n.t :date %></th>
									<th><%= i18n.t :value %></th>
									<th style="width: 50%;"><%= i18n.t :remark %></th>
									<th class="icon-column"></th>
									<% end %>
								</tr>
							</thead>
							<tbody>
								<% if @model.donations.empty? %>
								<tr id="no_donations_row"><td colspan="4"><%= genderize_tag(Donation.new, 'helpers.none_registered') %></td></tr>
								<% end %>

								<%= render @model.donations %>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>

<script>

	var transient_donations = 0;

	function new_donations() {
		return transient_donations > 0;
	}

	$(function() {

		function donation_field(id, field, value) {
			return '<input class="form-control" value="' + value + '" type="hidden" name="company[donations_attributes][' + id + '][' + field + ']" id="company_donations_attributes_' + id + '_' + field + '">'
		}

		$('#add_donation_btn').on('click', function add_donation() {

			if(validate_donation()) {

				transient_donations += 1;

				date = $('#new_donation_date').val();
				value = 'R$ ' + $('#new_donation_value').val();
				remark = $('#new_donation_remark').val();

				temp_id = (new Date).getTime();

				$.ajax({
					url: '<%= url_for(action: 'donation_row', controller: 'companies', only_path: false, protocol: 'http') %>', 
					data: {donation: {id: temp_id, donation_date: date, value: value, remark: remark}},
					success: function(result) {
			        	$('#donations_table > tbody:last-child').append(result);
			    	}
				});

				clean_donation_fields();

				$('#no_donations_row').hide();

			}
		});

		function clean_donation_fields() {
			$('#new_donation_date').val('');
			$('#new_donation_value').val('0,00');
			$('#new_donation_remark').val('');

			hide_errors_from_box('donation');
		}

		function validate_donation() {

			var errors = new Array();

			if(!$('#new_donation_date').val()) {
				errors.push('<%= I18n.t('errors.donation.date_mandatory') %>');
			}

			if((!$('#new_donation_value').val() || $('#new_donation_value').val() == '0,00') && !$('#new_donation_remark').val()) {
				errors.push('<%= I18n.t('errors.donation.value_or_remark') %>');
			}

			if(errors.length > 0) {
				display_error(errors, 'donation');
			}

			return errors.length == 0;
		}

		$('body').on('click', '#new_donation_btn', function() {
			set_datepicker();
		});

		$('body').on('click', '.remove_donation_btn', function() {
			id = $(this).parent().parent().parent().find('.donation_id').text();


			$('.donation_' + id + '_row').fadeOut('slow', function() {
         	   $('.donation_' + id + '_row').remove();
      	  	});

			transient_donations -= 1;

			if(document.getElementById("donations_table").rows.length == 2)
				$('#no_donations_row').show();
		});
	})

</script>